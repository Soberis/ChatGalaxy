# ChatGalaxy Git Flow åˆ†æ”¯ç®¡ç†å’Œéƒ¨ç½²æœ€ä½³å®è·µæŒ‡å—

## ğŸ“‹ æ¦‚è¿°

æœ¬æ–‡æ¡£è¯¦ç»†è¯´æ˜äº†ChatGalaxyé¡¹ç›®çš„Git Flowåˆ†æ”¯ç®¡ç†ç­–ç•¥ã€ä»£ç å®¡æŸ¥æµç¨‹ã€CI/CDè‡ªåŠ¨åŒ–éƒ¨ç½²å’Œæœ€ä½³å®è·µè§„èŒƒã€‚

## ğŸŒ³ åˆ†æ”¯ç®¡ç†ç­–ç•¥

### åˆ†æ”¯ç»“æ„

```
main (ç”Ÿäº§åˆ†æ”¯)
â”œâ”€â”€ develop (å¼€å‘åˆ†æ”¯)
â”‚   â”œâ”€â”€ feature/user-auth (åŠŸèƒ½åˆ†æ”¯)
â”‚   â”œâ”€â”€ feature/chat-interface (åŠŸèƒ½åˆ†æ”¯)
â”‚   â””â”€â”€ feature/ai-integration (åŠŸèƒ½åˆ†æ”¯)
â”œâ”€â”€ hotfix/critical-bug-fix (çƒ­ä¿®å¤åˆ†æ”¯)
â””â”€â”€ release/v1.1.0 (å‘å¸ƒåˆ†æ”¯)
```

### åˆ†æ”¯è¯´æ˜

#### ğŸš€ mainåˆ†æ”¯
- **ç”¨é€”**: ç”Ÿäº§ç¯å¢ƒä»£ç ï¼Œå§‹ç»ˆä¿æŒç¨³å®šå¯éƒ¨ç½²çŠ¶æ€
- **ä¿æŠ¤è§„åˆ™**: ä¸¥æ ¼ä¿æŠ¤ï¼Œä»…å…è®¸é€šè¿‡PRåˆå¹¶
- **è‡ªåŠ¨éƒ¨ç½²**: æ¨é€åˆ°mainåˆ†æ”¯è‡ªåŠ¨è§¦å‘ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²
- **å‘½åè§„èŒƒ**: `main`

#### ğŸ”§ developåˆ†æ”¯
- **ç”¨é€”**: ä¸»è¦å¼€å‘åˆ†æ”¯ï¼Œé›†æˆæ‰€æœ‰æ–°åŠŸèƒ½
- **ä¿æŠ¤è§„åˆ™**: è¦æ±‚çŠ¶æ€æ£€æŸ¥é€šè¿‡
- **CIæµ‹è¯•**: æ¯æ¬¡æ¨é€è‡ªåŠ¨è¿è¡Œå®Œæ•´æµ‹è¯•å¥—ä»¶
- **å‘½åè§„èŒƒ**: `develop`

#### âœ¨ featureåˆ†æ”¯
- **ç”¨é€”**: æ–°åŠŸèƒ½å¼€å‘ï¼Œä»developåˆ†æ”¯åˆ›å»º
- **ç”Ÿå‘½å‘¨æœŸ**: åŠŸèƒ½å®Œæˆååˆå¹¶å›developåˆ†æ”¯å¹¶åˆ é™¤
- **å‘½åè§„èŒƒ**: `feature/åŠŸèƒ½æè¿°` (å¦‚: `feature/user-authentication`)

#### ğŸ› hotfixåˆ†æ”¯
- **ç”¨é€”**: ç´§æ€¥ä¿®å¤ç”Ÿäº§ç¯å¢ƒé—®é¢˜
- **åˆ›å»ºæ¥æº**: ä»mainåˆ†æ”¯åˆ›å»º
- **åˆå¹¶ç›®æ ‡**: åŒæ—¶åˆå¹¶åˆ°mainå’Œdevelopåˆ†æ”¯
- **å‘½åè§„èŒƒ**: `hotfix/é—®é¢˜æè¿°` (å¦‚: `hotfix/login-error`)

#### ğŸ¯ releaseåˆ†æ”¯
- **ç”¨é€”**: å‘å¸ƒå‡†å¤‡ï¼ŒåŠŸèƒ½å†»ç»“å’Œbugä¿®å¤
- **åˆ›å»ºæ¥æº**: ä»developåˆ†æ”¯åˆ›å»º
- **åˆå¹¶ç›®æ ‡**: å®Œæˆååˆå¹¶åˆ°mainå’Œdevelopåˆ†æ”¯
- **å‘½åè§„èŒƒ**: `release/ç‰ˆæœ¬å·` (å¦‚: `release/v1.1.0`)

## ğŸ”„ å¼€å‘å·¥ä½œæµç¨‹

### 1. æ–°åŠŸèƒ½å¼€å‘æµç¨‹

```bash
# 1. åˆ‡æ¢åˆ°developåˆ†æ”¯å¹¶æ‹‰å–æœ€æ–°ä»£ç 
git checkout develop
git pull origin develop

# 2. åˆ›å»ºåŠŸèƒ½åˆ†æ”¯
git checkout -b feature/new-feature-name

# 3. å¼€å‘åŠŸèƒ½å¹¶æäº¤
git add .
git commit -m "feat: æ·»åŠ æ–°åŠŸèƒ½æè¿°"

# 4. æ¨é€åŠŸèƒ½åˆ†æ”¯
git push origin feature/new-feature-name

# 5. åˆ›å»ºPull Requeståˆ°developåˆ†æ”¯
# åœ¨GitHubç•Œé¢åˆ›å»ºPRï¼Œå¡«å†™PRæ¨¡æ¿

# 6. ä»£ç å®¡æŸ¥é€šè¿‡ååˆå¹¶
# åˆå¹¶ååˆ é™¤åŠŸèƒ½åˆ†æ”¯
git branch -d feature/new-feature-name
git push origin --delete feature/new-feature-name
```

### 2. çƒ­ä¿®å¤æµç¨‹

```bash
# 1. ä»mainåˆ†æ”¯åˆ›å»ºçƒ­ä¿®å¤åˆ†æ”¯
git checkout main
git pull origin main
git checkout -b hotfix/critical-issue

# 2. ä¿®å¤é—®é¢˜å¹¶æµ‹è¯•
git add .
git commit -m "fix: ä¿®å¤å…³é”®é—®é¢˜æè¿°"

# 3. æ¨é€çƒ­ä¿®å¤åˆ†æ”¯
git push origin hotfix/critical-issue

# 4. åˆ›å»ºPRåˆ°mainåˆ†æ”¯ï¼ˆç´§æ€¥åˆå¹¶ï¼‰
# 5. åŒæ—¶åˆ›å»ºPRåˆ°developåˆ†æ”¯ï¼ˆä¿æŒåŒæ­¥ï¼‰
```

### 3. å‘å¸ƒæµç¨‹

```bash
# 1. ä»developåˆ›å»ºå‘å¸ƒåˆ†æ”¯
git checkout develop
git pull origin develop
git checkout -b release/v1.1.0

# 2. æ›´æ–°ç‰ˆæœ¬å·å’Œå‘å¸ƒè¯´æ˜
# ä¿®æ”¹package.jsonã€ç‰ˆæœ¬æ–‡ä»¶ç­‰
git add .
git commit -m "chore: å‡†å¤‡v1.1.0å‘å¸ƒ"

# 3. æ¨é€å‘å¸ƒåˆ†æ”¯
git push origin release/v1.1.0

# 4. åˆ›å»ºPRåˆ°mainåˆ†æ”¯
# 5. åˆå¹¶ååˆ›å»ºGitHub Release
# 6. å°†å‘å¸ƒåˆ†æ”¯åˆå¹¶å›developåˆ†æ”¯
```

## ğŸ“ æäº¤ä¿¡æ¯è§„èŒƒ

### Conventional Commitsæ ¼å¼

```
<type>[optional scope]: <description>

[optional body]

[optional footer(s)]
```

### æäº¤ç±»å‹

- `feat`: æ–°åŠŸèƒ½
- `fix`: ä¿®å¤bug
- `docs`: æ–‡æ¡£æ›´æ–°
- `style`: ä»£ç æ ¼å¼è°ƒæ•´ï¼ˆä¸å½±å“åŠŸèƒ½ï¼‰
- `refactor`: ä»£ç é‡æ„
- `perf`: æ€§èƒ½ä¼˜åŒ–
- `test`: æµ‹è¯•ç›¸å…³
- `chore`: æ„å»ºè¿‡ç¨‹æˆ–è¾…åŠ©å·¥å…·å˜åŠ¨
- `ci`: CI/CDé…ç½®ä¿®æ”¹

### æäº¤ç¤ºä¾‹

```bash
# æ–°åŠŸèƒ½
git commit -m "feat(auth): æ·»åŠ JWTç”¨æˆ·è®¤è¯åŠŸèƒ½"

# ä¿®å¤bug
git commit -m "fix(chat): ä¿®å¤WebSocketè¿æ¥æ–­å¼€é—®é¢˜"

# æ–‡æ¡£æ›´æ–°
git commit -m "docs: æ›´æ–°APIæ–‡æ¡£å’Œéƒ¨ç½²æŒ‡å—"

# é‡æ„
git commit -m "refactor(components): é‡æ„èŠå¤©ç»„ä»¶ç»“æ„"
```

## ğŸ” ä»£ç å®¡æŸ¥æµç¨‹

### Pull Requestè¦æ±‚

1. **PRæ ‡é¢˜**: ä½¿ç”¨Conventional Commitsæ ¼å¼
2. **æè¿°å®Œæ•´**: å¡«å†™PRæ¨¡æ¿ï¼Œè¯´æ˜å˜æ›´å†…å®¹
3. **æµ‹è¯•è¦†ç›–**: ç¡®ä¿æ–°åŠŸèƒ½æœ‰å¯¹åº”æµ‹è¯•
4. **æ–‡æ¡£æ›´æ–°**: å¦‚éœ€è¦ï¼Œæ›´æ–°ç›¸å…³æ–‡æ¡£
5. **å†²çªè§£å†³**: è§£å†³æ‰€æœ‰åˆå¹¶å†²çª

### å®¡æŸ¥æ£€æŸ¥é¡¹

- [ ] ä»£ç ç¬¦åˆé¡¹ç›®ç¼–ç è§„èŒƒ
- [ ] åŠŸèƒ½å®ç°æ­£ç¡®ä¸”å®Œæ•´
- [ ] æµ‹è¯•ç”¨ä¾‹å……åˆ†ä¸”é€šè¿‡
- [ ] æ€§èƒ½å½±å“å¯æ¥å—
- [ ] å®‰å…¨æ€§è€ƒè™‘å……åˆ†
- [ ] æ–‡æ¡£æ›´æ–°åŠæ—¶
- [ ] æ— æ˜æ˜¾æŠ€æœ¯å€ºåŠ¡

### å®¡æŸ¥æµç¨‹

1. **è‡ªåŠ¨æ£€æŸ¥**: CI/CDæµæ°´çº¿è‡ªåŠ¨è¿è¡Œ
2. **äººå·¥å®¡æŸ¥**: è‡³å°‘1ä¸ªå›¢é˜Ÿæˆå‘˜å®¡æŸ¥
3. **ä¿®æ”¹åé¦ˆ**: æ ¹æ®å®¡æŸ¥æ„è§ä¿®æ”¹ä»£ç 
4. **æœ€ç»ˆæ‰¹å‡†**: æ‰€æœ‰æ£€æŸ¥é€šè¿‡ååˆå¹¶

## ğŸš€ CI/CDè‡ªåŠ¨åŒ–æµç¨‹

### åˆ†æ”¯è§¦å‘ç­–ç•¥

#### developåˆ†æ”¯
- **è§¦å‘æ¡ä»¶**: pushåˆ°developåˆ†æ”¯
- **æ‰§è¡Œå†…å®¹**: 
  - å‰ç«¯ï¼šTypeScriptæ£€æŸ¥ã€ä»£ç æ ¼å¼åŒ–ã€å•å…ƒæµ‹è¯•ã€è¦†ç›–ç‡æŠ¥å‘Š
  - åç«¯ï¼šä»£ç æ£€æŸ¥(ruff)ã€ç±»å‹æ£€æŸ¥(mypy)ã€å®‰å…¨æ‰«æ(bandit)ã€å•å…ƒæµ‹è¯•
  - å®‰å…¨ï¼šä¾èµ–æ¼æ´æ‰«æã€ä»£ç è´¨é‡æ£€æŸ¥

#### mainåˆ†æ”¯
- **è§¦å‘æ¡ä»¶**: pushåˆ°mainåˆ†æ”¯
- **æ‰§è¡Œå†…å®¹**:
  - å®Œæ•´CIæµ‹è¯•æµç¨‹
  - è‡ªåŠ¨éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ
  - éƒ¨ç½²åé›†æˆæµ‹è¯•
  - éƒ¨ç½²çŠ¶æ€é€šçŸ¥

### éƒ¨ç½²æµç¨‹

```mermaid
graph TD
    A[ä»£ç æ¨é€åˆ°main] --> B[CIæµ‹è¯•]
    B --> C{æµ‹è¯•é€šè¿‡?}
    C -->|æ˜¯| D[å‰ç«¯éƒ¨ç½²åˆ°Vercel]
    C -->|å¦| E[éƒ¨ç½²å¤±è´¥é€šçŸ¥]
    D --> F[åç«¯éƒ¨ç½²åˆ°Render]
    F --> G[å¥åº·æ£€æŸ¥]
    G --> H{æœåŠ¡æ­£å¸¸?}
    H -->|æ˜¯| I[é›†æˆæµ‹è¯•]
    H -->|å¦| J[å›æ»šéƒ¨ç½²]
    I --> K[éƒ¨ç½²æˆåŠŸé€šçŸ¥]
```

## ğŸ›¡ï¸ åˆ†æ”¯ä¿æŠ¤è§„åˆ™

### mainåˆ†æ”¯ä¿æŠ¤

```yaml
# GitHubåˆ†æ”¯ä¿æŠ¤è®¾ç½®
protection_rules:
  main:
    required_status_checks:
      strict: true
      contexts:
        - "CI Tests"
        - "Security Scan"
        - "Code Quality"
    enforce_admins: true
    required_pull_request_reviews:
      required_approving_review_count: 1
      dismiss_stale_reviews: true
      require_code_owner_reviews: false
    restrictions:
      users: []
      teams: []
    allow_force_pushes: false
    allow_deletions: false
```

### developåˆ†æ”¯ä¿æŠ¤

```yaml
develop:
  required_status_checks:
    strict: true
    contexts:
      - "CI Tests"
  enforce_admins: false
  required_pull_request_reviews:
    required_approving_review_count: 0
  allow_force_pushes: false
  allow_deletions: false
```

## ğŸ“Š è´¨é‡ä¿è¯

### ä»£ç è´¨é‡æŒ‡æ ‡

- **æµ‹è¯•è¦†ç›–ç‡**: â‰¥80%
- **ä»£ç é‡å¤ç‡**: â‰¤5%
- **åœˆå¤æ‚åº¦**: â‰¤10
- **æŠ€æœ¯å€ºåŠ¡**: æ§åˆ¶åœ¨å¯æ¥å—èŒƒå›´

### è‡ªåŠ¨åŒ–æ£€æŸ¥

1. **ä»£ç æ ¼å¼**: Prettier (å‰ç«¯) + Black (åç«¯)
2. **ä»£ç æ£€æŸ¥**: ESLint (å‰ç«¯) + Ruff (åç«¯)
3. **ç±»å‹æ£€æŸ¥**: TypeScript (å‰ç«¯) + MyPy (åç«¯)
4. **å®‰å…¨æ‰«æ**: Snyk + Bandit + Safety
5. **ä¾èµ–å®¡è®¡**: npm audit + pip-audit

## ğŸ”§ å¼€å‘ç¯å¢ƒé…ç½®

### æœ¬åœ°å¼€å‘è®¾ç½®

```bash
# 1. å…‹éš†ä»“åº“
git clone git@github.com:Soberis/ChatGalaxy.git
cd ChatGalaxy

# 2. åˆ‡æ¢åˆ°developåˆ†æ”¯
git checkout develop

# 3. å®‰è£…ä¾èµ–
# å‰ç«¯
cd frontend
pnpm install

# åç«¯
cd ../backend
pip install -r requirements.txt

# 4. é…ç½®ç¯å¢ƒå˜é‡
cp .env.example .env
# ç¼–è¾‘.envæ–‡ä»¶ï¼Œå¡«å…¥å¿…è¦é…ç½®

# 5. å¯åŠ¨å¼€å‘æœåŠ¡å™¨
# å‰ç«¯
pnpm run dev

# åç«¯
python -m uvicorn app.main:app --reload
```

### Git Hooksé…ç½®

```bash
# å®‰è£…pre-commit hooks
pip install pre-commit
pre-commit install

# é…ç½®.pre-commit-config.yaml
# åŒ…å«ä»£ç æ ¼å¼åŒ–ã€lintæ£€æŸ¥ç­‰
```

## ğŸ“ˆ ç›‘æ§å’Œç»´æŠ¤

### åˆ†æ”¯å¥åº·åº¦ç›‘æ§

- **åˆ†æ”¯æ•°é‡**: æ§åˆ¶æ´»è·ƒåˆ†æ”¯æ•°é‡
- **åˆå¹¶é¢‘ç‡**: å®šæœŸåˆå¹¶é¿å…å†²çª
- **ä»£ç å®¡æŸ¥**: è·Ÿè¸ªå®¡æŸ¥æ•ˆç‡å’Œè´¨é‡
- **éƒ¨ç½²æˆåŠŸç‡**: ç›‘æ§éƒ¨ç½²ç¨³å®šæ€§

### å®šæœŸç»´æŠ¤ä»»åŠ¡

1. **æ¯å‘¨**: æ¸…ç†å·²åˆå¹¶çš„åŠŸèƒ½åˆ†æ”¯
2. **æ¯æœˆ**: æ›´æ–°ä¾èµ–åŒ…å’Œå®‰å…¨è¡¥ä¸
3. **æ¯å­£åº¦**: è¯„ä¼°å’Œä¼˜åŒ–CI/CDæµç¨‹
4. **æ¯åŠå¹´**: å®¡æŸ¥åˆ†æ”¯ç­–ç•¥å’Œå·¥ä½œæµç¨‹

## ğŸš¨ åº”æ€¥å¤„ç†

### ç”Ÿäº§ç¯å¢ƒé—®é¢˜å¤„ç†

1. **ç«‹å³å“åº”**: ç¡®è®¤é—®é¢˜å½±å“èŒƒå›´
2. **å¿«é€Ÿä¿®å¤**: åˆ›å»ºhotfixåˆ†æ”¯ä¿®å¤
3. **ç´§æ€¥éƒ¨ç½²**: è·³è¿‡å¸¸è§„å®¡æŸ¥æµç¨‹
4. **äº‹ååˆ†æ**: åˆ†æé—®é¢˜åŸå› å’Œæ”¹è¿›æªæ–½

### å›æ»šç­–ç•¥

```bash
# 1. å¿«é€Ÿå›æ»šåˆ°ä¸Šä¸€ä¸ªç¨³å®šç‰ˆæœ¬
git checkout main
git revert HEAD
git push origin main

# 2. æˆ–è€…å›æ»šåˆ°æŒ‡å®šæäº¤
git reset --hard <stable-commit-hash>
git push --force-with-lease origin main
```

## ğŸ“š æœ€ä½³å®è·µæ€»ç»“

### å¼€å‘æœ€ä½³å®è·µ

1. **å°è€Œé¢‘ç¹çš„æäº¤**: ä¿æŒæäº¤ç²’åº¦é€‚ä¸­
2. **æ¸…æ™°çš„æäº¤ä¿¡æ¯**: ä½¿ç”¨è§„èŒƒçš„æäº¤æ ¼å¼
3. **åŠæ—¶åŒæ­¥**: å®šæœŸä»developåˆ†æ”¯æ‹‰å–æ›´æ–°
4. **åŠŸèƒ½åˆ†æ”¯çŸ­ç”Ÿå‘½å‘¨æœŸ**: é¿å…é•¿æœŸå­˜åœ¨çš„åˆ†æ”¯
5. **å®Œæ•´çš„æµ‹è¯•**: ç¡®ä¿æ–°åŠŸèƒ½æœ‰å……åˆ†æµ‹è¯•

### åä½œæœ€ä½³å®è·µ

1. **ç§¯æçš„ä»£ç å®¡æŸ¥**: è®¤çœŸå®¡æŸ¥æ¯ä¸ªPR
2. **å»ºè®¾æ€§çš„åé¦ˆ**: æä¾›æœ‰ä»·å€¼çš„æ”¹è¿›å»ºè®®
3. **åŠæ—¶å“åº”**: å¿«é€Ÿå“åº”å®¡æŸ¥è¯·æ±‚
4. **çŸ¥è¯†åˆ†äº«**: é€šè¿‡å®¡æŸ¥è¿‡ç¨‹åˆ†äº«çŸ¥è¯†
5. **æŒç»­æ”¹è¿›**: å®šæœŸä¼˜åŒ–å·¥ä½œæµç¨‹

### éƒ¨ç½²æœ€ä½³å®è·µ

1. **è‡ªåŠ¨åŒ–ä¼˜å…ˆ**: æœ€å¤§åŒ–è‡ªåŠ¨åŒ–ç¨‹åº¦
2. **æ¸è¿›å¼éƒ¨ç½²**: ä½¿ç”¨è“ç»¿éƒ¨ç½²æˆ–é‡‘ä¸é›€å‘å¸ƒ
3. **ç›‘æ§å‘Šè­¦**: å®Œå–„çš„ç›‘æ§å’Œå‘Šè­¦æœºåˆ¶
4. **å¿«é€Ÿå›æ»š**: å‡†å¤‡å¿«é€Ÿå›æ»šæ–¹æ¡ˆ
5. **æ–‡æ¡£ç»´æŠ¤**: ä¿æŒéƒ¨ç½²æ–‡æ¡£æ›´æ–°

---

**æ³¨æ„**: æœ¬æŒ‡å—åº”æ ¹æ®å›¢é˜Ÿè§„æ¨¡å’Œé¡¹ç›®éœ€æ±‚è¿›è¡Œè°ƒæ•´ã€‚å®šæœŸè¯„ä¼°å’Œä¼˜åŒ–å·¥ä½œæµç¨‹ï¼Œç¡®ä¿å…¶é€‚åº”é¡¹ç›®å‘å±•éœ€è¦ã€‚